apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: langfuse-db
  namespace: langfuse
spec:
  instances: 1
  storage:
    size: 10Gi
    storageClass: longhorn
  postgresql:
    parameters:
      shared_buffers: "256MB"
      max_connections: "100"
  bootstrap:
    initdb:
      database: langfuse
      owner: langfuse
      secret:
        name: langfuse-db-credentials
  # TODO: Enable R2 backups when ready
  # backup:
  #   barmanObjectStore:
  #     destinationPath: s3://langfuse-backups/postgres
  #     endpointURL: https://<ACCOUNT_ID>.r2.cloudflarestorage.com
  #     s3Credentials:
  #       accessKeyId:
  #         name: langfuse-secrets
  #         key: R2_ACCESS_KEY_ID
  #       secretAccessKey:
  #         name: langfuse-secrets
  #         key: R2_SECRET_ACCESS_KEY
  #   retentionPolicy: "30d"
